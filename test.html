<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form method="POST" id="form">
        <input type="text" id="text">
        <input type="file" id="file">
        <button id="btn">click</button>
    </form>

    <script>
        function getCookie(name) {
      let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
            }
            return cookieValue;
        }

    </script>
    <script>
        const csrftoken = getCookie('csrftoken')

        form = document.querySelector("#form")
        
        form.addEventListener('submit',(e)=>{
            e.preventDefault()
            // console.log('btn click')
            const url = 'http://127.0.0.1:8000/api/comment/'


            const text = document.querySelector("#text")
            const file = document.querySelector("#file")

            console.log(text.value,file)
            const uploadData = new FormData();
            
            uploadData.append('comment', text.value)
            uploadData.append('images', file.files[0], file.files[0].name)
            fetch(url,{
                method:'POST',
                headers:{
                    "X-CSRFToken":"application/json",

                },
                body:uploadData
            })
            .then(res=>console.log(res))
            .catch(err => console.log(err))
        })
       
        
    </script>


<script>
    import React, { useState } from 'react';
import ReactDom from 'react-dom'

const Test = ()=>{
    const [text, setText] = useState('')
    const [file, setFile] = useState()

    const getCookie = (name)=> {
        let cookieValue = null;
          if (document.cookie && document.cookie !== '') {
              const cookies = document.cookie.split(';');
              for (let i = 0; i < cookies.length; i++) {
                  const cookie = cookies[i].trim();
                  // Does this cookie string begin with the name we want?
                  if (cookie.substring(0, name.length + 1) === (name + '=')) {
                      cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                      break;
                  }
              }
              }
              return cookieValue;
          }

    const handleSubmit = (e)=>{
        e.preventDefault()
        console.log('제출시작')

        const url = "http://127.0.0.1:8000/api/comment/"

        const uploadData = new FormData();
        uploadData.append('comment', text)
        uploadData.append('images', file, file.name )
        uploadData.append('comment_country', "1" )
        uploadData.append('user_profile', "1" )

        fetch(url,{
            method:"POST",
            headers:{
                "X-CSRFToken": getCookie("csrftoken"),
            },
            body:uploadData
        })
        .then(res=>console.log(res))
        .catch(err=>console.log(err))
    }
    return(
        <>
        <form method="POST" onSubmit={handleSubmit}>
            <input type="text" value={text} onChange={(e)=>setText(e.target.value)}/>
            <input type="file" onChange={e=>setFile(e.target.files[0])}/>
            <button>click</button>
        </form>
        </>
    )
}



ReactDom.render(<Test/>, document.querySelector("#root"))
</script>
</body>
</html>